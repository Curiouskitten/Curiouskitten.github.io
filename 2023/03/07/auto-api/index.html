<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>pythonj接口自动化框架 | 柒仔的学习栈</title><meta name="keywords" content="python 接口自动化"><meta name="author" content="柒仔"><meta name="copyright" content="柒仔"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="基于Unittest的接口自动化测试框架，可直接套用，根据实际业务做内容修改 目录结构各模块介绍Http请求能力封装-http_request.py引用三方库requests若本地没有： 1pip install requests  123456789101112131415import requestsdef send_http_requests(url, method, **kwargs):">
<meta property="og:type" content="article">
<meta property="og:title" content="pythonj接口自动化框架">
<meta property="og:url" content="http://example.com/2023/03/07/auto-api/index.html">
<meta property="og:site_name" content="柒仔的学习栈">
<meta property="og:description" content="基于Unittest的接口自动化测试框架，可直接套用，根据实际业务做内容修改 目录结构各模块介绍Http请求能力封装-http_request.py引用三方库requests若本地没有： 1pip install requests  123456789101112131415import requestsdef send_http_requests(url, method, **kwargs):">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/girl_cp.jpg">
<meta property="article:published_time" content="2023-03-07T07:20:54.000Z">
<meta property="article:modified_time" content="2023-03-07T18:00:50.166Z">
<meta property="article:author" content="柒仔">
<meta property="article:tag" content="python 接口自动化">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/girl_cp.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/03/07/auto-api/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'pythonj接口自动化框架',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-08 02:00:50'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="柒仔的学习栈" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div></div></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/girl_cp.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">柒仔的学习栈</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">pythonj接口自动化框架</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-07T07:20:54.000Z" title="发表于 2023-03-07 15:20:54">2023-03-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-07T18:00:50.166Z" title="更新于 2023-03-08 02:00:50">2023-03-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="pythonj接口自动化框架"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>基于Unittest的接口自动化测试框架，可直接套用，根据实际业务做内容修改</p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><h2 id="各模块介绍"><a href="#各模块介绍" class="headerlink" title="各模块介绍"></a>各模块介绍</h2><h3 id="Http请求能力封装-http-request-py"><a href="#Http请求能力封装-http-request-py" class="headerlink" title="Http请求能力封装-http_request.py"></a>Http请求能力封装-http_request.py</h3><p>引用三方库requests<br>若本地没有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install requests</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def send_http_requests(url, method, **kwargs):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    发送http请求</span></span><br><span class="line"><span class="string">    :param url: 请求url</span></span><br><span class="line"><span class="string">    :param method: 请求方法</span></span><br><span class="line"><span class="string">    :param kwargs: 请求参数，headers,cookies,params,data,json...</span></span><br><span class="line"><span class="string">    :return: 请求结果</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 统一请求方法格式</span></span><br><span class="line">    method = method.lower()</span><br><span class="line">    res = getattr(requests, method)(url, **kwargs)</span><br><span class="line">    <span class="built_in">return</span> res</span><br></pre></td></tr></table></figure>
<p>知识点：getattr()–获取类方法<br>如上代码，获取requests模块下，method方法，跟上对应的参数<br>当然也可以用最基本的方法使用if的条件语句，判断是何种请求方法走不同分支来处理</p>
<h3 id="日志处理：日志器的封装-log-handler-py"><a href="#日志处理：日志器的封装-log-handler-py" class="headerlink" title="日志处理：日志器的封装-log_handler.py"></a>日志处理：日志器的封装-log_handler.py</h3><p>引用python自带库logging<br>具体逻辑：创建一个日志器–&gt;设置日志的打印等级–&gt;创建一个日志处理器–&gt;格式化日志–&gt;将格式化后的日志添加到日志器上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_logger(name, filename, mode=<span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>, fmt=None, debug=False):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    创建日志器</span></span><br><span class="line"><span class="string">    :param name: 日志名称</span></span><br><span class="line"><span class="string">    :param filename: 日志文件名和路径</span></span><br><span class="line"><span class="string">    :param mode:文件读写类型，默认a-追加</span></span><br><span class="line"><span class="string">    :param encoding-编码类型</span></span><br><span class="line"><span class="string">    :param fmt: 日志格式</span></span><br><span class="line"><span class="string">    :param debug: bool-True：调试模式，False-非调试模式</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 创建一个日志器</span></span><br><span class="line">    logger = logging.getLogger(name)</span><br><span class="line">    <span class="comment"># 设置日志器打印等级--不可省去</span></span><br><span class="line">    logger.setLevel(logging.DEBUG)</span><br><span class="line">    <span class="keyword">if</span> debug is True:</span><br><span class="line">        file_level = logging.DEBUG</span><br><span class="line">        console_level = logging.DEBUG</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        file_level = logging.INFO</span><br><span class="line">        console_level = logging.INFO</span><br><span class="line">    <span class="keyword">if</span> fmt is None:</span><br><span class="line">        fmt = <span class="string">&quot;%(levelname)s:%(asctime)s-[%(filename)s--&gt;line:%(lineno)d]-%(levelname)s:%(message)s&quot;</span></span><br><span class="line">    <span class="comment"># 创建日志处理器</span></span><br><span class="line">    file_handler = logging.FileHandler(filename=filename, mode=mode, encoding=encoding)</span><br><span class="line">    file_handler.setLevel(file_level)</span><br><span class="line">    console_handler = logging.StreamHandler()</span><br><span class="line">    console_handler.setLevel(console_level)</span><br><span class="line">    <span class="comment"># 日志格式化</span></span><br><span class="line">    formatter = logging.Formatter(fmt=fmt)</span><br><span class="line">    file_handler.setFormatter(formatter)</span><br><span class="line">    console_handler.setFormatter(formatter)</span><br><span class="line">    <span class="comment"># 将格式化后的日志处理器添加到日志器上</span></span><br><span class="line">    logger.addHandler(file_handler)</span><br><span class="line">    logger.addHandler(console_handler)</span><br><span class="line">    <span class="built_in">return</span> logger</span><br></pre></td></tr></table></figure>
<p>日志的处理登记做成了两类，最详细的console类–debug；相对清晰的文件类–info<br>补充：logging模块中的日志等级<br><img src="log_level.png" alt="logging模块日志等级"></p>
<h3 id="Excel文件处理器–excel-handler-py"><a href="#Excel文件处理器–excel-handler-py" class="headerlink" title="Excel文件处理器–excel_handler.py"></a>Excel文件处理器–excel_handler.py</h3><p>引用三方库：openpyxl<br>下载指令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install openpyxl</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">from openpyxl import load_workbook</span><br><span class="line">from pprint import pprint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_exceldata(path, sheetname):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    从excel读取数据</span></span><br><span class="line"><span class="string">    :param path: excel文件路径</span></span><br><span class="line"><span class="string">    :param sheetname: 表名</span></span><br><span class="line"><span class="string">    :return: 从excel中读取的用例</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># read_only-只读，要读取一个excel文件但是又不想改动他.或者表中的数据量很大，需要分段获取，但是使用read_only需要close()</span></span><br><span class="line">    wb = load_workbook(filename=path, read_only=True)</span><br><span class="line">    sh = wb[sheetname]</span><br><span class="line">    row = sh.max_row</span><br><span class="line">    column = sh.max_column</span><br><span class="line">    <span class="comment"># 获取所有key</span></span><br><span class="line">    keys = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(1, column+1):</span><br><span class="line">        key = sh.cell(1, i).value</span><br><span class="line">        keys.append(key)</span><br><span class="line">    <span class="comment"># 获取用例参数</span></span><br><span class="line">    data = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(2, row+1):</span><br><span class="line">        temp =&#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(1, column+1):</span><br><span class="line">            value = sh.cell(i, j).value</span><br><span class="line">            temp[keys[j-1]] = value</span><br><span class="line">        <span class="comment"># # 将请求体&amp;预期数据转换成python对象</span></span><br><span class="line">        <span class="comment"># try:</span></span><br><span class="line">        <span class="comment">#     temp[&#x27;request_data&#x27;] = json.loads(temp[&#x27;request_data&#x27;])</span></span><br><span class="line">        <span class="comment">#     temp[&#x27;expect_data&#x27;] = json.loads(temp[&#x27;expect_data&#x27;])</span></span><br><span class="line">        <span class="comment"># except json.decoder.JSONDecodeError:</span></span><br><span class="line">        <span class="comment">#     raise ValueError(&#x27;用例格式错误！&#x27;)</span></span><br><span class="line">        data.append(temp)</span><br><span class="line">    <span class="built_in">return</span> data</span><br></pre></td></tr></table></figure>
<p>在整个自动化运行的过程中，几乎不会对excel文件本身数据做修改，因此此处仅用到获取数据的方法load_workbook；定义一个读取数据的方法即可<br>Attention：excel文件模版一定要保持干净！！不要存在非必要的空格行or列，上述方法通过获取最大行和最大列来获取目标数据的<br>我使用的excel的格式：<br><img src="api_cases.png" alt="excel_form"><br>则对应上述代码：sheetname=demo<br>在指定范围的for循环中遵循左开右闭。也就是右边的数实际取值是n-1，所以此处column&amp;row都+1<br>最终以列表中嵌套字典的方式，获取所有表中的数据，例：<br>[{“id”:1,””title”:用例A”…,},{…}]</p>
<h3 id="配置项封装-config-handler-py-settings-py"><a href="#配置项封装-config-handler-py-settings-py" class="headerlink" title="配置项封装-config_handler.py/settings.py"></a>配置项封装-config_handler.py/settings.py</h3><p>为了减少不同环境对框架复用性的影响，封装一个动态配置处理器，常见的配置项管理文件类型有：.ini, .yaml, .yml, .cfg, .conf;但为了更加方便的调用和获取数据，我直接使用python文件进行了配置管理；针对ini&amp;yaml类型的数据不做过多的赘述：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">import yaml</span><br><span class="line">from configparser import ConfigParser</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_config(filename, encoding=<span class="string">&quot;utf-8&quot;</span>) -&gt; dict:</span><br><span class="line">    <span class="comment"># 获取文件后缀名</span></span><br><span class="line">    suffix = filename.split(<span class="string">&quot;.&quot;</span>)[-1]</span><br><span class="line">    <span class="comment"># 判断配置文件类型</span></span><br><span class="line">    <span class="keyword">if</span> suffix <span class="keyword">in</span> [<span class="string">&quot;ini&quot;</span>, <span class="string">&quot;cfg&quot;</span>, <span class="string">&quot;cnf&quot;</span>]:</span><br><span class="line">        conf = ConfigParser()</span><br><span class="line">        conf.read(filenames=filename, encoding=encoding)</span><br><span class="line">        <span class="comment"># 获取文件中所有key</span></span><br><span class="line">        data = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> section <span class="keyword">in</span> conf.sections():</span><br><span class="line">            <span class="comment"># 获取对应section下所有value</span></span><br><span class="line">            values = conf.items(section)</span><br><span class="line">            data[section] = dict(values)</span><br><span class="line">    <span class="keyword">elif</span> suffix <span class="keyword">in</span> [<span class="string">&quot;yaml&quot;</span>, <span class="string">&quot;yml&quot;</span>]:</span><br><span class="line">        with open(file=filename, mode=<span class="string">&#x27;r&#x27;</span>, encoding=encoding) as fb:</span><br><span class="line">            data = yaml.load(stream=fb, Loader=yaml.FullLoader)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        raise ValueError(<span class="string">&quot;不能识别的配置文件后缀&quot;</span>)</span><br><span class="line">    <span class="built_in">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Config:</span><br><span class="line">    def __init__(self, filename, encoding=<span class="string">&quot;utf-8&quot;</span>):</span><br><span class="line">        <span class="comment"># 初始化</span></span><br><span class="line">        self.filename = filename</span><br><span class="line">        self.encoding = encoding</span><br><span class="line">        self.suffix = filename.split(<span class="string">&quot;.&quot;</span>)[-1]</span><br><span class="line">        <span class="keyword">if</span> self.suffix not <span class="keyword">in</span> [<span class="string">&quot;ini&quot;</span>, <span class="string">&quot;conf&quot;</span>, <span class="string">&quot;cnf&quot;</span>, <span class="string">&quot;yml&quot;</span>, <span class="string">&quot;yaml&quot;</span>]:</span><br><span class="line">            raise ValueError(<span class="string">&quot;不能识别的配置文件后缀&quot;</span>)</span><br><span class="line"></span><br><span class="line">    def __parse_ini(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        解析ini文件</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        conf = ConfigParser()</span><br><span class="line">        conf.read(filenames=self.filename, encoding=self.encoding)</span><br><span class="line">        <span class="comment"># 获取文件中所有key</span></span><br><span class="line">        data = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> section <span class="keyword">in</span> conf.sections():</span><br><span class="line">            <span class="comment"># 获取对应section下所有value</span></span><br><span class="line">            values = conf.items(section)</span><br><span class="line">            data[section] = dict(values)</span><br><span class="line">        <span class="built_in">return</span> data</span><br><span class="line"></span><br><span class="line">    def __parse_yaml(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        解析yaml文件</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        with open(file=self.filename, mode=<span class="string">&#x27;r&#x27;</span>, encoding=self.encoding) as fb:</span><br><span class="line">            data = yaml.load(stream=fb, Loader=yaml.FullLoader)</span><br><span class="line">        <span class="built_in">return</span> data</span><br><span class="line"></span><br><span class="line">    def parse(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        解析</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> self.suffix <span class="keyword">in</span> [<span class="string">&quot;yaml&quot;</span>, <span class="string">&quot;yml&quot;</span>]:</span><br><span class="line">            <span class="built_in">return</span> self.__parse_yaml()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">return</span> self.__parse_ini()</span><br></pre></td></tr></table></figure>
<p>.ini文件格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">log</span>]</span><br><span class="line">name = <span class="string">&quot;rest_register&quot;</span></span><br><span class="line"></span><br><span class="line">[test_data]</span><br><span class="line"></span><br><span class="line">[report]</span><br></pre></td></tr></table></figure>
<p>.yaml文件格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">log</span>:</span><br><span class="line">  name: dpword_test_log</span><br><span class="line">  filename: <span class="built_in">log</span>/testlog.log</span><br><span class="line">  debug: <span class="literal">true</span></span><br><span class="line">testdata:</span><br><span class="line">  file: data/apicase_lemonregister.xlsx</span><br><span class="line">report:</span><br><span class="line">  filename: testReport/注册接口测试报告.html</span><br><span class="line">  description: 注册模块测试</span><br></pre></td></tr></table></figure>

<p>settings.py</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">import os</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cur_time = datetime.now().strftime(<span class="string">&quot;%Y%m%d%H%M&quot;</span>)</span><br><span class="line"><span class="comment"># os.path.abspath()--&gt;根据当前操作系统获取对应类型的绝对路径</span></span><br><span class="line">path = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志配置</span></span><br><span class="line">LOG_CONFIG = &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;通用日志器&quot;</span>,</span><br><span class="line">    <span class="string">&quot;filename&quot;</span>: os.path.join(path, f<span class="string">&quot;log/&#123;cur_time&#125;testlog.log&quot;</span>),</span><br><span class="line">    <span class="string">&quot;debug&quot;</span>: True</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试用例配置</span></span><br><span class="line">TEST_DATA = &#123;</span><br><span class="line">    <span class="string">&quot;path&quot;</span>: os.path.join(path, <span class="string">&quot;data/apicase_lemonregister.xlsx&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试报告配置</span></span><br><span class="line">REPORT_CONFIG = &#123;</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;注册接口测试&quot;</span>,</span><br><span class="line">    <span class="string">&quot;filename&quot;</span>: <span class="string">&quot;注册接口测试报告.html&quot;</span>,</span><br><span class="line">    <span class="string">&quot;report_dir&quot;</span>: os.path.join(path, <span class="string">&quot;testReport&quot;</span>),</span><br><span class="line">    <span class="string">&quot;title&quot;</span>: <span class="string">&quot;测试报告&quot;</span>,</span><br><span class="line">    <span class="string">&quot;theme&quot;</span>: <span class="string">&quot;theme_cyan&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;br&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 域名</span></span><br><span class="line">DOMAIN = &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;http://api.lemonban.com/futureloan&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接口配置</span></span><br><span class="line">INTERFACE = &#123;</span><br><span class="line">    <span class="string">&quot;register&quot;</span>: <span class="string">&quot;/member/register&quot;</span>,</span><br><span class="line">    <span class="string">&quot;login&quot;</span>: <span class="string">&quot;/member/login&quot;</span>,</span><br><span class="line">    <span class="string">&quot;recharge&quot;</span>: <span class="string">&quot;/member/recharge&quot;</span>,</span><br><span class="line">    <span class="string">&quot;add&quot;</span>: <span class="string">&quot;/loan/add&quot;</span>,</span><br><span class="line">    <span class="string">&quot;audit&quot;</span>: <span class="string">&quot;/loan/audit&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库配置</span></span><br><span class="line">DB_CONFIG = &#123;</span><br><span class="line">    <span class="string">&quot;host&quot;</span>: <span class="string">&quot;sh-cynosdbmysql-grp-p8d7farc.sql.tencentcdb.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;port&quot;</span>: 29391,</span><br><span class="line">    <span class="string">&quot;user&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;Deepword2021&quot;</span>,</span><br><span class="line">    <span class="string">&quot;charset&quot;</span>: <span class="string">&quot;utf8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;db&quot;</span>: <span class="string">&quot;deepuser&quot;</span>,</span><br><span class="line">    <span class="string">&quot;autocommit&quot;</span>: True  <span class="comment"># 自动提交事务打开，防止mysql可重复读特性</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DB_CONFIG_LEMON = &#123;</span><br><span class="line">    <span class="string">&quot;host&quot;</span>: <span class="string">&quot;api.lemonban.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;port&quot;</span>: 3306,</span><br><span class="line">    <span class="string">&quot;user&quot;</span>: <span class="string">&quot;future&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">    <span class="string">&quot;charset&quot;</span>: <span class="string">&quot;utf8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;db&quot;</span>: <span class="string">&quot;future&quot;</span>,</span><br><span class="line">    <span class="string">&quot;autocommit&quot;</span>: True,</span><br><span class="line">    <span class="string">&quot;cursorclass&quot;</span>: pymysql.cursors.DictCursor  <span class="comment"># 设置游标类型，返回不同类型数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接使用python文件管理动态参数的好处就是在执行过程中，python无需再去翻译成自己理解的逻辑再去执行，可以通过字典将不同类型的参数归类，省去了翻译这一步骤。也不容易出现奇怪的非必要的问题。<br>Attention：settings中的参数key均采用大写字母</p>
<h3 id="数据库处理器-db-handler-py"><a href="#数据库处理器-db-handler-py" class="headerlink" title="数据库处理器-db_handler.py"></a>数据库处理器-db_handler.py</h3><p>当前数据库的类型非常多，诸如关系型—mysql，非关系型—mongodb，redis等等，此处介绍的是最最最基础也最最最常用的mysql的处理<br>引用三方库：pymysql<br>本地没有直接pip：pip install pymysql<br>简单介绍下pymysql的使用：<br>1）    创建数据库连接<br>2）    创建游标对象cursor<br>3）    执行sql语句<br>4）    获取结果<br>5）    关闭数据库连接<br>具体到代码步骤：<br><img src="db_handler.png" alt="way_of_pymysql"></p>
<p>如果仅仅通过定义函数的方法，每一次请求mysql都需要如此来一套，创建连接-执行语句-再关闭连接，一旦数据量大起来对mysql的压力会十分大，且浪费时间和资源；为了解决这个问题，通过封装一个数据库处理类，定义一个初始化函数，创建一个连接，可被其他方法共享连接，详细如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">import settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class DB:</span><br><span class="line">    def __init__(self, db_config: dict):</span><br><span class="line">        <span class="comment"># 创建&amp;关闭连接是耗时且浪费资源的，封装成类-仅创建一个连接即可调用多个方法，是比较效率的</span></span><br><span class="line">        self.conn = pymysql.connect(**db_config)</span><br><span class="line"></span><br><span class="line">    def __del__(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        类运行完毕，关闭数据库链接</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        self.conn.close()</span><br><span class="line"></span><br><span class="line">    def get_one_data(self, sql):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        获取查询结果首个数据</span></span><br><span class="line"><span class="string">        :param sql: 执行的sql语句</span></span><br><span class="line"><span class="string">        :return: 查询结果</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        with self.conn.cursor() as cursor:</span><br><span class="line">            cursor.execute(sql)</span><br><span class="line">            <span class="built_in">return</span> cursor.fetchone()</span><br><span class="line"></span><br><span class="line">    def get_many_data(self, sql, num: int):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        获取多个查询结果，指定结果数量</span></span><br><span class="line"><span class="string">        :param sql: 执行的sql语句</span></span><br><span class="line"><span class="string">        :param num: 指定需要抓取的数据数量-int</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        with self.conn.cursor() as cursor:</span><br><span class="line">            cursor.execute(sql)</span><br><span class="line">            <span class="built_in">return</span> cursor.fetchmany(num)</span><br><span class="line"></span><br><span class="line">    def get_all_data(self, sql):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        获取所有查询结果</span></span><br><span class="line"><span class="string">        :param sql: 执行的sql语句</span></span><br><span class="line"><span class="string">        :return: 指定需要抓去的数据数量</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        with self.conn.cursor() as cursor:</span><br><span class="line">            cursor.execute(sql)</span><br><span class="line">            <span class="built_in">return</span> cursor.fetchall()</span><br><span class="line"></span><br><span class="line">    def exist(self, sql):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        查询数据是否存在</span></span><br><span class="line"><span class="string">        :param sql: 执行的sql语句</span></span><br><span class="line"><span class="string">        :return: True-数据存在，False-数据不存在</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        with self.conn.cursor() as cursor:</span><br><span class="line">            cursor.execute(sql)</span><br><span class="line">            <span class="keyword">if</span> cursor.fetchone():</span><br><span class="line">                <span class="built_in">return</span> True</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">return</span> False</span><br></pre></td></tr></table></figure>

<h3 id="模块初始化-init-py"><a href="#模块初始化-init-py" class="headerlink" title="模块初始化-init.py"></a>模块初始化-<strong>init</strong>.py</h3><p>在整个框架的使用中，有些类和方法被频繁的调用，如果每个模块都要重新引用一次，随着模块的增多，代码免不了冗余和繁琐，对被测系统的性能也会带来非必要的压力，例如频繁的调用数据库处理器，即使封装数据库处理模块的时候已经简化了连接数，但是还不够。<br><strong>init</strong>.py</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from .log_handler import get_logger</span><br><span class="line">import settings</span><br><span class="line"><span class="comment"># from .config_handler import get_config</span></span><br><span class="line">from .db_handler import DB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># config = get_config(&quot;config.yaml&quot;)</span></span><br><span class="line">logger = get_logger(**settings.LOG_CONFIG)</span><br><span class="line"><span class="comment"># 实现单项目共享一个连接，提高资源利用率</span></span><br><span class="line">db_client = DB(settings.DB_CONFIG_LEMON)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="随机数生成"><a href="#随机数生成" class="headerlink" title="随机数生成"></a>随机数生成</h3><p>在自动化测试的过程中，随机参数是必不可少的，可以根据一定的规则生成需要的随机数。为此我单独创建了一个模块random_sample.py来统一生成各种随机数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line">import string</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_randomsample(length=64, mode=<span class="string">&#x27;mix&#x27;</span>):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    获取指定长度，指定类型随机数，可指定参数类型</span></span><br><span class="line"><span class="string">    :param length:</span></span><br><span class="line"><span class="string">    :param mode:预获取的参数类型，默认mix-大小写英文字母+数字，支持digit：纯数字字符串；letter-纯英文字母</span></span><br><span class="line"><span class="string">    :return:random_result-自定义随机数</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    str_digit = [random.choice(string.digits) <span class="keyword">for</span> i <span class="keyword">in</span> range(length)]</span><br><span class="line">    str_mix = [random.choice(string.ascii_letters + string.digits) <span class="keyword">for</span> i <span class="keyword">in</span> range(length)]</span><br><span class="line">    str_letter = [random.choice(string.ascii_letters) <span class="keyword">for</span> i <span class="keyword">in</span> range(length)]</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&#x27;mix&#x27;</span>:</span><br><span class="line">        random_result = <span class="string">&#x27;&#x27;</span>.join(str_mix)</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">&#x27;digit&#x27;</span>:</span><br><span class="line">        random_result = <span class="string">&#x27;&#x27;</span>.join(str_digit)</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">&#x27;letter&#x27;</span>:</span><br><span class="line">        random_result = <span class="string">&#x27;&#x27;</span>.join(str_letter)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        random_result = <span class="string">&#x27;Illegal mode&#x27;</span></span><br><span class="line">    <span class="built_in">return</span> random_result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_note(<span class="built_in">times</span>=50, sleep=5):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    随机获取音符</span></span><br><span class="line"><span class="string">    :param times:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    musical_note = [<span class="string">&#x27;do&#x27;</span>, <span class="string">&#x27;ra&#x27;</span>, <span class="string">&#x27;mi&#x27;</span>, <span class="string">&#x27;fa&#x27;</span>, <span class="string">&#x27;so&#x27;</span>, <span class="string">&#x27;la&#x27;</span>, <span class="string">&#x27;si&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="built_in">times</span>):</span><br><span class="line">        random_note = random.choice(musical_note)</span><br><span class="line">        <span class="built_in">print</span>(random_note)</span><br><span class="line">        time.sleep(sleep)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="测试数据处理"><a href="#测试数据处理" class="headerlink" title="测试数据处理"></a>测试数据处理</h3><p>随机参数已经有单独的模块生成，那么下一步就是用生成的参数动态替换掉每次从excel中获取的参数槽位，因此又增加了一个处理此问题的模块test_data_handler.py</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line">from common import db_client</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def generate_phone():</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    生成随机电话号码，要求：1开头，第二位3-9的数字，总共11位</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    sec_num = str(random.randint(3, 9))</span><br><span class="line">    tail_num = [<span class="string">&quot;1&quot;</span>, sec_num]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(8):</span><br><span class="line">        ele = str(random.randint(0, 9))</span><br><span class="line">        tail_num.append(ele)</span><br><span class="line">    phone = <span class="string">&#x27;&#x27;</span>.join(tail_num)</span><br><span class="line">    <span class="built_in">return</span> phone</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def generate_phone2():</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    生成随机电话号码</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    sample = [<span class="string">&quot;135&quot;</span>, <span class="string">&quot;136&quot;</span>, <span class="string">&quot;137&quot;</span>, <span class="string">&quot;138&quot;</span>, <span class="string">&quot;139&quot;</span>, <span class="string">&quot;158&quot;</span>, <span class="string">&quot;159&quot;</span>, <span class="string">&quot;188&quot;</span>,</span><br><span class="line">              <span class="string">&quot;132&quot;</span>, <span class="string">&quot;156&quot;</span>, <span class="string">&quot;133&quot;</span>, <span class="string">&quot;153&quot;</span>, <span class="string">&quot;180&quot;</span>, <span class="string">&quot;189&quot;</span>]</span><br><span class="line">    header = random.choice(sample)</span><br><span class="line">    phone_sample = [header]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(8):</span><br><span class="line">        ele = str(random.randint(0, 9))</span><br><span class="line">        phone_sample.append(ele)</span><br><span class="line">    phone = <span class="string">&#x27;&#x27;</span>.join(phone_sample)</span><br><span class="line">    <span class="built_in">return</span> phone</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def generate_no_user_phone(sql=<span class="string">&quot;select * from member where mobile_phone = &#123;&#125;&quot;</span>):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    生成库内不存在的随机电话号码，要求：1开头，第二位3-9的数字，总共11位</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 生成随机手机号</span></span><br><span class="line">    phone = generate_phone2()</span><br><span class="line">    sql = sql.format(phone)</span><br><span class="line">    phone_tuple = db_client.exist(sql)</span><br><span class="line">    <span class="keyword">while</span> phone_tuple:</span><br><span class="line">        phone = generate_phone2()</span><br><span class="line">    <span class="built_in">return</span> phone</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def replace_by_re(json_str, object):</span><br><span class="line">    args = re.findall(<span class="string">&quot;#(.+?)#&quot;</span>, json_str)</span><br><span class="line">    <span class="keyword">for</span> arg <span class="keyword">in</span> args:</span><br><span class="line">        json_str = json_str.replace(<span class="string">&quot;#&#123;&#125;#&quot;</span>.format(arg), str(getattr(object, arg)))</span><br><span class="line">    <span class="built_in">return</span> json_str</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这个模块除了替换槽位的方法是通用的，其他方法均需要根据实际的业务场景来定义不同的方法。那么这里就仅仅讲解一下replace_by_re()这个方法了。<br>这里重点引用的方法re – 正则匹配<br>此处不会详细介绍正则表达式。仅对用到的正则匹配方法做介绍。<br>re.findall<br>在字符串中找到正则表达式所匹配的所有子串，并返回一个列表，如果有多个匹配模式，则返回元组列表，如果没有找到匹配的，则返回空列表。<br>注意： match 和 search 是匹配一次 findall 匹配所有。<br>语法格式为：<br>findall(string[, pos[, endpos]])<br>参数：<br>•    string : 待匹配的字符串。<br>•    pos : 可选参数，指定字符串的起始位置，默认为 0。<br>•    endpos : 可选参数，指定字符串的结束位置，默认为字符串的长度。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line"></span><br><span class="line">pattern = re.compile(r<span class="string">&#x27;\d+&#x27;</span>)   <span class="comment"># 查找数字</span></span><br><span class="line">result1 = pattern.findall(<span class="string">&#x27;runoob 123 google 456&#x27;</span>)</span><br><span class="line">result2 = pattern.findall(<span class="string">&#x27;run88oob123google456&#x27;</span>, 0, 18)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result1)</span><br><span class="line"><span class="built_in">print</span>(result2)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;456&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;88&#x27;</span>, <span class="string">&#x27;12&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此处用到的正则表达式模式：</p>
<ol>
<li>   利用括号分组</li>
<li>   用问号实现可选匹配</li>
<li>   用星号匹配零次或多次</li>
<li>   用加号匹配一次或多次</li>
<li>   通配字符</li>
</ol>
<p>在正则表达式中，.(英文句号)为通配符，它匹配除了换行之外的所有字符串<br>Attention：. 仅匹配一个字符<br>eg.</p>
<blockquote>
<blockquote>
<blockquote>
<p>atRegex = re.compile(r’.at’)<br>atRegex.findall(“The cat in the hat sat on the flat mat.”)<br>Result: [“cat”, “hat”, “sat”, “lat”, “mat”]<br>结果中flat仅匹配到了lat</p>
</blockquote>
</blockquote>
</blockquote>
<p>（）为分组符号<br>一个括号内的字符为一组，可以使用group()匹配对象方法，从一个分组中获取匹配的文本。<br>Eg.</p>
<blockquote>
<blockquote>
<blockquote>
<p>phoneNumRegex = re.compile(r“(\d\d\d)-(\d\d\d-\d\d\d)”)<br>mo = phoneNumRegex.search(“My number is 415-555-4242.”)<br>mo.group(1)<br>415<br>mo.group(2)<br>555-4242<br>mo.group(0)<br>415-555-4242<br>mo.group()<br>415-555-4242</p>
</blockquote>
</blockquote>
</blockquote>
<p>？表明它前面的分组在这个模式中是可选的，可以理解为：匹配这个问号之前的分组0次后者1次</p>
<pre><code>*意味着匹配0次或多次，即星号之前的分组，可以在文本中出现任意次，它可以不存在，或者一次又一次的重复
&gt;&gt;&gt;batRegex = re.compile(r”Bat(wo)*man”)
&gt;&gt;&gt;mo1 = batRegex.search(“The Adventures of Batman”)
&gt;&gt;&gt;mo1.group()
</code></pre>
<p>“Batman”</p>
<blockquote>
<blockquote>
<blockquote>
<p>mo2 = batRegex.search(“The Adventures of Batwoman”)<br>mo2.group()<br>“Batwoman”<br>mo3 = batRegex.search(“The Adventures of Batwowowowoman”)<br>mo3 = mo3.group()<br>“Batwowowowoman”</p>
</blockquote>
</blockquote>
</blockquote>
<p>+意味着匹配一次或多次，相比较星号不要求分组出现在匹配的字符串中，加号前的分组必须至少出现一次。<br>多个匹配模式，返回元祖列表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line"></span><br><span class="line">result = re.findall(r<span class="string">&#x27;(\w+)=(\d+)&#x27;</span>, <span class="string">&#x27;set width=20 and height=10&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结果：<br>[(‘width’, ‘20’),(‘height’, ‘10’)]<br>综合以上知识点，来看框架代码中的“#(.+?)#”<br>    def replace_by_re(json_str, object):<br>    args = re.findall(“#(.+?)#”, json_str)<br>    for arg in args:<br>        json_str = json_str.replace(“#{}#”.format(arg), str(getattr(object, arg)))<br>    return json_str<br>被匹配的字符串为json_str<br>在json_str中匹配的字符串格式为#xxx#，考虑到json_str中可能存在多个这样格式的字符串，所以用井号将字符分组，分组内的字符串无特殊的要求所以使用通配符匹配分组内的所有字符串。但是有一个要求，井号内字符不能为空，所以使用+号保证预匹配的字符串必须完整的存在一次</p>
<h3 id="前置用例"><a href="#前置用例" class="headerlink" title="前置用例"></a>前置用例</h3><p>业务流<br>在做接口自动化时，往往需要先测通核心业务流，再进行单接口测试<br>接口测试业务流设计<br>1）站在用户角度<br>2）重视全局而非细节<br>3）先测主流程，后测分流程<br>4）只测正例</p>
<h3 id="基于Unittest框架的测试执行模块的封装"><a href="#基于Unittest框架的测试执行模块的封装" class="headerlink" title="基于Unittest框架的测试执行模块的封装"></a>基于Unittest框架的测试执行模块的封装</h3><p>涉及三方库：ddt<br>—-data driver test—数据驱动测试，只有测试流程完全一致的时候可以使用ddt<br>目的：测试数据与测试用例代码分离，通过外部测试数据动态生成用例<br>下载执行：pip install ddt<br>下载好后为了更好的适配本地的脚本，修改了一小部分代码(进入ddt模块找这段):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def _get_test_data_docstring(func, value):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;Returns a docstring based on the following resolution strategy:</span></span><br><span class="line"><span class="string">    1. Passed value is not a &quot;</span>primitive<span class="string">&quot; and has a docstring, then use it.</span></span><br><span class="line"><span class="string">    2. In all other cases return None, i.e the test name is used.</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> value.get(<span class="string">&#x27;title&#x27;</span>, None):</span><br><span class="line">        <span class="built_in">return</span> value.get(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> not _is_primitive(value) and value.__doc__:</span><br><span class="line">        <span class="built_in">return</span> value.__doc__</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">return</span> None</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>效果就是将html报告中的用例描述，取用excel中填入的title的值</p>
<p>1．    相同业务模块为一个py文件<br><img src="testcases_modle.png" alt="testcases_modle"></p>
<p>2．    为了简化和解耦，减少后续模块代码量，可以编写一个基类如base_case.py，逻辑与common目录下的__init__.py一样；在基类中定义通用的流程和代码逻辑，例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">import json</span><br><span class="line">import warnings</span><br><span class="line">import settings</span><br><span class="line">from common import logger, db_client</span><br><span class="line">from common.test_data_handler import replace_by_re, generate_no_user_phone</span><br><span class="line">from common.http_request import send_http_requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class BaseTest(unittest.TestCase):</span><br><span class="line">    name = <span class="string">&quot;base用例&quot;</span>  <span class="comment"># 这个属性应该被覆盖</span></span><br><span class="line">    logger = logger</span><br><span class="line">    db = db_client</span><br><span class="line">    settings = settings</span><br><span class="line">    @classmethod</span><br><span class="line">    def setUpClass(cls) -&gt; None:</span><br><span class="line">        warnings.simplefilter(<span class="string">&#x27;ignore&#x27;</span>, ResourceWarning)</span><br><span class="line">        cls.logger.info(<span class="string">&quot;=====================&#123;&#125;接口开始测试========================&quot;</span>.format(cls.name))</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def tearDownClass(cls) -&gt; None:</span><br><span class="line">        cls.logger.info(<span class="string">&quot;=====================&#123;&#125;接口测试结束========================&quot;</span>.format(cls.name))</span><br><span class="line"></span><br><span class="line">    def setUp(self) -&gt; None:</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        方法级的前置条件，每个测试函数执行前执行</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        self.logger.info(<span class="string">&quot;用例测试开始！&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    def tearDown(self) -&gt; None:</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        方法级后置处理，每个测试函数执行结束执行</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        self.logger.info(<span class="string">&quot;用例测试结束！&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    def checkout(self, <span class="keyword">case</span>):</span><br><span class="line">        <span class="comment"># 测试数据处理-绑定对象属性，便于下面的测试流程处理函数</span></span><br><span class="line">        self.case = <span class="keyword">case</span></span><br><span class="line">        self.case[<span class="string">&quot;url&quot;</span>] = settings.DOMAIN[<span class="string">&quot;test&quot;</span>] + settings.INTERFACE[<span class="keyword">case</span>[<span class="string">&quot;url&quot;</span>]]</span><br><span class="line">        <span class="comment"># 测试数据处理</span></span><br><span class="line">        self.pre_test_data()</span><br><span class="line">        <span class="comment"># 测试步骤</span></span><br><span class="line">        self.step()</span><br><span class="line">        <span class="comment"># 响应状态码断言</span></span><br><span class="line">        self.assert_status_code()</span><br><span class="line">        <span class="comment"># 响应数据断言</span></span><br><span class="line">        self.assert_json_response()</span><br><span class="line">        <span class="comment"># 数据库断言</span></span><br><span class="line">        self.assert_db_true()</span><br><span class="line"></span><br><span class="line">    def pre_test_data(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        预制数据处理</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 判断是否生成手机号码</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;#phone#&quot;</span> <span class="keyword">in</span> self.case[<span class="string">&quot;request_data&quot;</span>]:</span><br><span class="line">            phone = generate_no_user_phone()</span><br><span class="line">            <span class="comment"># 替换槽位</span></span><br><span class="line">            self.case[<span class="string">&quot;request_data&quot;</span>] = self.case[<span class="string">&quot;request_data&quot;</span>].replace(<span class="string">&quot;#phone#&quot;</span>, phone)</span><br><span class="line">            <span class="keyword">if</span> self.case.get(<span class="string">&quot;sql&quot;</span>):</span><br><span class="line">                self.case[<span class="string">&quot;sql&quot;</span>] = self.case[<span class="string">&quot;sql&quot;</span>].replace(<span class="string">&quot;#phone#&quot;</span>, phone)</span><br><span class="line">        <span class="comment"># 替换槽位</span></span><br><span class="line">        self.case[<span class="string">&quot;request_data&quot;</span>] = replace_by_re(self.case[<span class="string">&quot;request_data&quot;</span>], self)</span><br><span class="line">        <span class="keyword">if</span> self.case.get(<span class="string">&quot;sql&quot;</span>):  <span class="comment"># 针对部分用例不涉及sql校验，使用此方法保证不会因为sql为空时报错</span></span><br><span class="line">            try:</span><br><span class="line">                self.case[<span class="string">&quot;sql&quot;</span>] = replace_by_re(self.case[<span class="string">&quot;sql&quot;</span>], self)</span><br><span class="line">            except Exception as e:</span><br><span class="line">                self.logger.error(<span class="string">&quot;用例用例：&#123;&#125;替换sql槽位失败！&quot;</span>.format(self.case[<span class="string">&quot;sql&quot;</span>]))</span><br><span class="line">                raise e</span><br><span class="line">        <span class="comment"># 将数据转换位python对象</span></span><br><span class="line">        try:</span><br><span class="line">            self.case[<span class="string">&quot;request_data&quot;</span>] = json.loads(self.case[<span class="string">&quot;request_data&quot;</span>])</span><br><span class="line">            self.case[<span class="string">&quot;expect_data&quot;</span>] = json.loads(self.case[<span class="string">&quot;expect_data&quot;</span>])</span><br><span class="line">        except Exception as e:</span><br><span class="line">            self.logger.error(<span class="string">&quot;用例：&#123;&#125;数据转换字符串失败！&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line">            raise e</span><br><span class="line"></span><br><span class="line">    def step(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        测试步骤</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        try:</span><br><span class="line">            self.response = send_http_requests(url=self.case[<span class="string">&quot;url&quot;</span>], method=self.case[<span class="string">&quot;method&quot;</span>],</span><br><span class="line">                                               **self.case[<span class="string">&quot;request_data&quot;</span>])</span><br><span class="line">        except Exception as e:</span><br><span class="line">            self.logger.exception(<span class="string">&quot;用例：【&#123;&#125;】发送http请求失败&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line">            self.logger.debug(<span class="string">&quot;method:&#123;&#125;&quot;</span>.format(self.case[<span class="string">&quot;method&quot;</span>]))</span><br><span class="line">            self.logger.debug(<span class="string">&quot;response_data:&#123;&#125;&quot;</span>.format(self.case[<span class="string">&quot;request_data&quot;</span>]))</span><br><span class="line">            self.logger.info(<span class="string">&quot;响应结果：&#123;&#125;&quot;</span>.format(self.response.json()))</span><br><span class="line">            self.logger.info(<span class="string">&quot;预期结果：&#123;&#125;&quot;</span>.format(self.case[<span class="string">&quot;expect_data&quot;</span>]))</span><br><span class="line">            raise e</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.logger.info(<span class="string">&quot;用例【&#123;&#125;】发送http请求成功！&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line"></span><br><span class="line">    def assert_status_code(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        响应状态码断言</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        try:</span><br><span class="line">            self.assertEqual(int(self.case[<span class="string">&quot;status_code&quot;</span>]), self.response.status_code)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            self.logger.exception(<span class="string">&quot;用例：【&#123;&#125;】响应状态码断言失败！&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line">            raise e</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.logger.info(<span class="string">&quot;响应状态码断言成功！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    def assert_json_response(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        json响应结果断言--根据情况这里只校验了部分参数，根据实际项改写</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 这里的逻辑写死，只是针对当前项目</span></span><br><span class="line">        res_data = self.response.json()</span><br><span class="line">        try:</span><br><span class="line">            self.assertEqual(self.case[<span class="string">&#x27;expect_data&#x27;</span>][<span class="string">&#x27;code&#x27;</span>], res_data[<span class="string">&#x27;code&#x27;</span>])</span><br><span class="line">            self.assertEqual(self.case[<span class="string">&#x27;expect_data&#x27;</span>][<span class="string">&#x27;msg&#x27;</span>], res_data[<span class="string">&#x27;msg&#x27;</span>])</span><br><span class="line">        except Exception as e:</span><br><span class="line">            self.logger.exception(<span class="string">&quot;用例：【&#123;&#125;】响应结果断言失败！&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line">            self.logger.debug(<span class="string">&quot;预期结果：&#123;&#125;&quot;</span>.format(self.case[<span class="string">&quot;expect_data&quot;</span>][<span class="string">&quot;code&quot;</span>]))</span><br><span class="line">            self.logger.debug(<span class="string">&quot;预期结果：&#123;&#125;&quot;</span>.format(self.case[<span class="string">&quot;expect_data&quot;</span>][<span class="string">&quot;msg&quot;</span>]))</span><br><span class="line">            self.logger.debug(<span class="string">&quot;实际结果：&#123;&#125;&quot;</span>.format(res_data[<span class="string">&#x27;code&#x27;</span>]))</span><br><span class="line">            self.logger.debug(<span class="string">&quot;实际结果：&#123;&#125;&quot;</span>.format(res_data[<span class="string">&#x27;msg&#x27;</span>]))</span><br><span class="line">            raise e</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.logger.info(<span class="string">&quot;用例：【&#123;&#125;】响应结果断言成功！&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line"></span><br><span class="line">    def assert_db_true(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        断言数据库存在数据</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> self.case.get(<span class="string">&quot;sql&quot;</span>):</span><br><span class="line">            <span class="comment"># 查询数据</span></span><br><span class="line">            try:</span><br><span class="line">                db_res = self.db.exist(self.case[<span class="string">&quot;sql&quot;</span>])</span><br><span class="line">                self.assertTrue(db_res)</span><br><span class="line">            except Exception as e:</span><br><span class="line">                self.logger.exception(<span class="string">&quot;用例：【&#123;&#125;】数据库断言失败！&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line">                self.logger.debug(<span class="string">&quot;执行sql：&#123;&#125;&quot;</span>.format(self.case[<span class="string">&quot;sql&quot;</span>]))</span><br><span class="line">                raise e</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.logger.info(<span class="string">&quot;数据库断言成功！&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上述代码中，遵循流程：<br>前置&amp;后置用例内容定义：<br>针对类的setUpClass &amp; tearDownClass;<br>针对方法的setup&amp;teardown<br>测试流程的定义：<br>测试步骤-&gt;响应状态码断言-&gt;响应数据断言-&gt;数据库断言</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def checkout(self, <span class="keyword">case</span>):</span><br><span class="line">    <span class="comment"># 测试数据处理-绑定对象属性，便于下面的测试流程处理函数</span></span><br><span class="line">    self.case = <span class="keyword">case</span></span><br><span class="line">    self.case[<span class="string">&quot;url&quot;</span>] = settings.DOMAIN[<span class="string">&quot;test&quot;</span>] + settings.INTERFACE[<span class="keyword">case</span>[<span class="string">&quot;url&quot;</span>]]</span><br><span class="line">    <span class="comment"># 测试数据处理</span></span><br><span class="line">    self.pre_test_data()</span><br><span class="line">    <span class="comment"># 测试步骤</span></span><br><span class="line">    self.step()</span><br><span class="line">    <span class="comment"># 响应状态码断言</span></span><br><span class="line">    self.assert_status_code()</span><br><span class="line">    <span class="comment"># 响应数据断言</span></span><br><span class="line">    self.assert_json_response()</span><br><span class="line">    <span class="comment"># 数据库断言</span></span><br><span class="line">    self.assert_db_true()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>此处的checkout方法其实是对上述步骤的一个汇总调用，在TestBase基类中定义每个步骤的处理方法，再定义一个汇总的调用方法，那么后续拥有相同测试步骤的模块用例就可以直接调用checkout(case)，这一种方法来执行整个用例了。<br>以下为每个测试步骤的方法定义：<br>self.pre_test_data()—预制数据处理<br>必然存在的步骤：<br>1）    参数替换；<br>2）    将excel文件中请求体转换成python对象，方便直接引用进接口请求。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def pre_test_data(self):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    预制数据处理</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 替换槽位</span></span><br><span class="line">    try:</span><br><span class="line">        self.case[<span class="string">&quot;request_data&quot;</span>] = replace_by_re(self.case[<span class="string">&quot;request_data&quot;</span>], self)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        self.logger.error(<span class="string">&quot;用例：&#123;&#125;替换槽位失败&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line">        raise e</span><br><span class="line">    <span class="keyword">if</span> self.case.get(<span class="string">&quot;sql&quot;</span>):  <span class="comment"># 针对部分用例不涉及sql校验，使用此方法保证不会因为sql为空时报错</span></span><br><span class="line">        try:</span><br><span class="line">            self.case[<span class="string">&quot;sql&quot;</span>] = replace_by_re(self.case[<span class="string">&quot;sql&quot;</span>], self)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            self.logger.error(<span class="string">&quot;用例用例：&#123;&#125;替换sql槽位失败！&quot;</span>.format(self.case[<span class="string">&quot;sql&quot;</span>]))</span><br><span class="line">            raise e</span><br></pre></td></tr></table></figure>

<p>self.step() # 测试步骤<br>发送http请求，当然除了http请求之外还有诸如websocket请求，根据具体项目进行封装处理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def step(self):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    测试步骤</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    try:</span><br><span class="line">        self.response = send_http_requests(url=self.case[<span class="string">&quot;url&quot;</span>], method=self.case[<span class="string">&quot;method&quot;</span>],</span><br><span class="line">                                           **self.case[<span class="string">&quot;request_data&quot;</span>])</span><br><span class="line">    except Exception as e:</span><br><span class="line">        self.logger.exception(<span class="string">&quot;用例：【&#123;&#125;】发送http请求失败&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line">        self.logger.debug(<span class="string">&quot;method:&#123;&#125;&quot;</span>.format(self.case[<span class="string">&quot;method&quot;</span>]))</span><br><span class="line">        self.logger.debug(<span class="string">&quot;response_data:&#123;&#125;&quot;</span>.format(self.case[<span class="string">&quot;request_data&quot;</span>]))</span><br><span class="line">        self.logger.info(<span class="string">&quot;响应结果：&#123;&#125;&quot;</span>.format(self.response.json()))</span><br><span class="line">        self.logger.info(<span class="string">&quot;预期结果：&#123;&#125;&quot;</span>.format(self.case[<span class="string">&quot;expect_data&quot;</span>]))</span><br><span class="line">        raise e</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.logger.info(<span class="string">&quot;用例【&#123;&#125;】发送http请求成功！&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br></pre></td></tr></table></figure>

<p>self.assert_status_code() # 响应状态码断言<br>针对上述http请求结果与excel中提取的预期结果做比较</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def assert_status_code(self):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    响应状态码断言</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    try:</span><br><span class="line">        self.assertEqual(int(self.case[<span class="string">&quot;status_code&quot;</span>]), self.response.status_code)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        self.logger.exception(<span class="string">&quot;用例：【&#123;&#125;】响应状态码断言失败！&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line">        raise e</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.logger.info(<span class="string">&quot;响应状态码断言成功！&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>self.assert_json_response() —-响应结果断言，这个非固定，切记：所有的框架的代码都是不固定的，一定是根据对应的业务场景做变更的，这里就直接提供一个简单粗暴的方式<br>提取excel中对应的响应体与上述http请求结果做比较</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">def assert_json_response(self):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    响应结果断言--根据情况这里只校验了部分参数，根据实际项改写</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 这里的逻辑写死，只是针对当前项目</span></span><br><span class="line">    res_data = self.response.json()</span><br><span class="line">    try:</span><br><span class="line">        self.assertEqual(self.case[<span class="string">&#x27;expect_data&#x27;</span>][<span class="string">&#x27;code&#x27;</span>], res_data[<span class="string">&#x27;code&#x27;</span>])</span><br><span class="line">        self.assertEqual(self.case[<span class="string">&#x27;expect_data&#x27;</span>][<span class="string">&#x27;msg&#x27;</span>], res_data[<span class="string">&#x27;msg&#x27;</span>])</span><br><span class="line">    except Exception as e:</span><br><span class="line">        self.logger.exception(<span class="string">&quot;用例：【&#123;&#125;】响应结果断言失败！&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line">        self.logger.debug(<span class="string">&quot;预期结果：&#123;&#125;&quot;</span>.format(self.case[<span class="string">&quot;expect_data&quot;</span>][<span class="string">&quot;code&quot;</span>]))</span><br><span class="line">        self.logger.debug(<span class="string">&quot;预期结果：&#123;&#125;&quot;</span>.format(self.case[<span class="string">&quot;expect_data&quot;</span>][<span class="string">&quot;msg&quot;</span>]))</span><br><span class="line">        self.logger.debug(<span class="string">&quot;实际结果：&#123;&#125;&quot;</span>.format(res_data[<span class="string">&#x27;code&#x27;</span>]))</span><br><span class="line">        self.logger.debug(<span class="string">&quot;实际结果：&#123;&#125;&quot;</span>.format(res_data[<span class="string">&#x27;msg&#x27;</span>]))</span><br><span class="line">        raise e</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.logger.info(<span class="string">&quot;用例：【&#123;&#125;】响应结果断言成功！&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>self.assert_db_true() —-数据库校验，原理同上述响应断言，提取excel文件中的sql语句，连接并执行数据库语句，此处事例为mysql可以根据具体的项目架构需求再封装诸如：redis连接，mogodb连接，甚至是es查询<br>源码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def assert_db_true(self):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    断言数据库存在数据</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> self.case.get(<span class="string">&quot;sql&quot;</span>):             <span class="comment">#[get]尝试获取对应数据，若没有返回空，而不会报错</span></span><br><span class="line">        <span class="comment"># 查询数据</span></span><br><span class="line">        try:</span><br><span class="line">            db_res = self.db.exist(self.case[<span class="string">&quot;sql&quot;</span>])</span><br><span class="line">            self.assertTrue(db_res)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            self.logger.exception(<span class="string">&quot;用例：【&#123;&#125;】数据库断言失败！&quot;</span>.format(self.case[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line">            self.logger.debug(<span class="string">&quot;执行sql：&#123;&#125;&quot;</span>.format(self.case[<span class="string">&quot;sql&quot;</span>]))</span><br><span class="line">            raise e</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.logger.info(<span class="string">&quot;数据库断言成功！&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>至此，整理一下抽取基类的思路：数据参数化，相同步骤统一执行</p>
<ol>
<li>   数据参数化：将所有的非定值的数据作为槽位。使用随机数或按照一定规律生成的参数对号入座，槽位表示的方式很多，具体看如何定义，可以是#randint#也可以是{randint}；最后将替换完槽位的数据统一进行格式化，由字符串（str）转换为可被python直接用于请求的python对象。</li>
<li>   相同的步骤执行：不难发现，所有接口测试都绕不开：填写参数-&gt;发送请求-&gt;获取响应-&gt;状态码&amp;响应体的校验<br>当然有的也存在数据库的校验<br>那么在第一步数据参数化的时候，在针对某一模块也可以简单的理解为对一个sheet页中所有的请求参数都做了统一的替换和格式化<br>那么我只需要在Unittest和ddt的帮助下，一条一条的执行用例即可</li>
<li>   前置&amp;后置条件：非必要，基本上基类中只需要标注xxx开始执行，xxx执行结束即可，因为接口自动化的最终目的是整个业务场景的验证，所以必然存在不同模块的前置和后置执行内容不一致的情况-需要针对不同的模块做改写。所以基类无需做过多封装<br>类级别—setUpClass &amp; tearDownClass<br>方法级别—setUp &amp; teardown</li>
</ol>
<p>测试基类本身就是针对Unittest的属性和方法改写，而项目开发则是具体到每个功能测试模块，再引入基类再改写的过程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">@data(*cases)</span><br><span class="line">   def test_audit(self, <span class="keyword">case</span>):</span><br><span class="line">       self.logger.info(<span class="string">&quot;用例【&#123;&#125;】开始测试&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span>.format(<span class="keyword">case</span>[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line">       <span class="comment"># 1. 用例数据处理</span></span><br><span class="line">       <span class="keyword">case</span>[<span class="string">&quot;request_data&quot;</span>] = replace_by_re(<span class="keyword">case</span>[<span class="string">&quot;request_data&quot;</span>], TestAudit)</span><br><span class="line">       <span class="keyword">case</span>[<span class="string">&quot;request_data&quot;</span>] = json.loads(<span class="keyword">case</span>[<span class="string">&quot;request_data&quot;</span>])</span><br><span class="line">       <span class="keyword">case</span>[<span class="string">&quot;expect_data&quot;</span>] = json.loads(<span class="keyword">case</span>[<span class="string">&quot;expect_data&quot;</span>])</span><br><span class="line">       <span class="keyword">case</span>[<span class="string">&quot;url&quot;</span>] = settings.DOMAIN[<span class="string">&quot;test&quot;</span>] + settings.INTERFACE[<span class="keyword">case</span>[<span class="string">&quot;url&quot;</span>]]</span><br><span class="line">       self.logger.debug(<span class="string">&quot;请求URL：&#123;&#125;&quot;</span>.format(<span class="keyword">case</span>[<span class="string">&quot;url&quot;</span>]))</span><br><span class="line">       <span class="comment"># 2. 测试步骤</span></span><br><span class="line">       self.logger.debug(<span class="string">&quot;method:&#123;&#125;&quot;</span>.format(<span class="keyword">case</span>[<span class="string">&quot;method&quot;</span>]))</span><br><span class="line">       self.logger.debug(<span class="string">&quot;args:&#123;&#125;&quot;</span>.format(<span class="keyword">case</span>[<span class="string">&quot;request_data&quot;</span>]))</span><br><span class="line">       response = send_http_requests(url=<span class="keyword">case</span>[<span class="string">&quot;url&quot;</span>], method=<span class="keyword">case</span>[<span class="string">&quot;method&quot;</span>], **<span class="keyword">case</span>[<span class="string">&quot;request_data&quot;</span>])</span><br><span class="line">       self.logger.info(<span class="string">&quot;响应结果：&#123;&#125;&quot;</span>.format(response.json()))</span><br><span class="line">       self.logger.info(<span class="string">&quot;预期结果：&#123;&#125;&quot;</span>.format(<span class="keyword">case</span>[<span class="string">&quot;expect_data&quot;</span>]))</span><br><span class="line">       <span class="comment"># 3. 断言</span></span><br><span class="line">       try:</span><br><span class="line">           self.assertEqual(int(<span class="keyword">case</span>[<span class="string">&quot;status_code&quot;</span>]), response.status_code)</span><br><span class="line">           self.assertEqual(<span class="keyword">case</span>[<span class="string">&#x27;expect_data&#x27;</span>][<span class="string">&#x27;code&#x27;</span>], response.json()[<span class="string">&#x27;code&#x27;</span>])</span><br><span class="line">           self.assertEqual(<span class="keyword">case</span>[<span class="string">&#x27;expect_data&#x27;</span>][<span class="string">&#x27;msg&#x27;</span>], response.json()[<span class="string">&#x27;msg&#x27;</span>])</span><br><span class="line">       except AssertionError as e:</span><br><span class="line">           self.logger.exception(<span class="string">&quot;用例【&#123;&#125;】响应结果断言失败！&quot;</span>.format(<span class="keyword">case</span>[<span class="string">&quot;title&quot;</span>]))</span><br><span class="line">           self.logger.debug(<span class="string">&quot;预期结果:&#123;&#125;&quot;</span>.format(<span class="keyword">case</span>[<span class="string">&quot;expect_data&quot;</span>]))</span><br><span class="line">           self.logger.debug(<span class="string">&quot;响应结果:&#123;&#125;&quot;</span>.format(response.json()))</span><br><span class="line">           raise e</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           self.logger.info(<span class="string">&quot;响应结果断言成功！&quot;</span>)</span><br><span class="line">       <span class="comment"># 数据库校验</span></span><br><span class="line">       <span class="keyword">if</span> <span class="keyword">case</span>[<span class="string">&#x27;sql&#x27;</span>]:</span><br><span class="line">           try:</span><br><span class="line">               <span class="keyword">case</span>[<span class="string">&#x27;sql&#x27;</span>] = replace_by_re(<span class="keyword">case</span>[<span class="string">&#x27;sql&#x27;</span>], TestAudit)</span><br><span class="line">               self.logger.debug(<span class="string">&quot;查询语句为：&#123;&#125;&quot;</span>.format(<span class="keyword">case</span>[<span class="string">&quot;sql&quot;</span>]))</span><br><span class="line">               db_res = self.db.exist(<span class="keyword">case</span>[<span class="string">&#x27;sql&#x27;</span>])</span><br><span class="line">           except Exception as e:</span><br><span class="line">               self.logger.exception(<span class="string">&quot;数据库断言失败！&quot;</span>)</span><br><span class="line">               self.logger.debug(<span class="string">&quot;执行的sql:&#123;&#125;&quot;</span>.format(<span class="keyword">case</span>[<span class="string">&#x27;sql&#x27;</span>]))</span><br><span class="line">               raise e</span><br><span class="line">           <span class="keyword">else</span>:</span><br><span class="line">               self.logger.info(<span class="string">&quot;数据库断言成功！&quot;</span>)</span><br><span class="line">           self.assertTrue(db_res)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>上述代码直接可以写为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@data(*cases)</span><br><span class="line">    def test_audit(self, <span class="keyword">case</span>):</span><br><span class="line">        self.checkout(<span class="keyword">case</span>)</span><br></pre></td></tr></table></figure>
<p>有了基类的帮忙，原本繁琐的步骤，3行代码引用即可解决，工具化</p>
<p>Attention!!!—-用于占位的槽位名称一定要与预置的参数命名一直，如excel文件中定义的槽位名称为#user_id#，则在预置用例中需要将参数命名为user_id的类属性。</p>
<p>当存在与通用步骤不一致的业务步骤，只需要继承基类后，直接改写或者重写方法即可。<br>至此，框架的基础搭建就结束了，后续需要根据具体的业务增加相关的处理模块。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">柒仔</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/03/07/auto-api/">http://example.com/2023/03/07/auto-api/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">柒仔的学习栈</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python-%E6%8E%A5%E5%8F%A3%E8%87%AA%E5%8A%A8%E5%8C%96/">python 接口自动化</a></div><div class="post_share"><div class="social-share" data-image="/img/girl_cp.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/02/22/openpyxl%E5%AE%9E%E6%93%8D/"><img class="next-cover" src="/img/python3.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">openpyxl实操</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">柒仔</div><div class="author-info__description">用技术倾注对生活的热爱</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">blog内容为个人整理汇总笔记，不定时整理更新，评论功能暂不开启</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84%E6%A8%A1%E5%9D%97%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">各模块介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Http%E8%AF%B7%E6%B1%82%E8%83%BD%E5%8A%9B%E5%B0%81%E8%A3%85-http-request-py"><span class="toc-number">2.1.</span> <span class="toc-text">Http请求能力封装-http_request.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86%EF%BC%9A%E6%97%A5%E5%BF%97%E5%99%A8%E7%9A%84%E5%B0%81%E8%A3%85-log-handler-py"><span class="toc-number">2.2.</span> <span class="toc-text">日志处理：日志器的封装-log_handler.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Excel%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86%E5%99%A8%E2%80%93excel-handler-py"><span class="toc-number">2.3.</span> <span class="toc-text">Excel文件处理器–excel_handler.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%B0%81%E8%A3%85-config-handler-py-settings-py"><span class="toc-number">2.4.</span> <span class="toc-text">配置项封装-config_handler.py&#x2F;settings.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%84%E7%90%86%E5%99%A8-db-handler-py"><span class="toc-number">2.5.</span> <span class="toc-text">数据库处理器-db_handler.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E5%88%9D%E5%A7%8B%E5%8C%96-init-py"><span class="toc-number">2.6.</span> <span class="toc-text">模块初始化-init.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%94%9F%E6%88%90"><span class="toc-number">2.7.</span> <span class="toc-text">随机数生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">2.8.</span> <span class="toc-text">测试数据处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%94%A8%E4%BE%8B"><span class="toc-number">2.9.</span> <span class="toc-text">前置用例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EUnittest%E6%A1%86%E6%9E%B6%E7%9A%84%E6%B5%8B%E8%AF%95%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9D%97%E7%9A%84%E5%B0%81%E8%A3%85"><span class="toc-number">2.10.</span> <span class="toc-text">基于Unittest框架的测试执行模块的封装</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/03/07/auto-api/" title="pythonj接口自动化框架"><img src="/img/girl_cp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pythonj接口自动化框架"/></a><div class="content"><a class="title" href="/2023/03/07/auto-api/" title="pythonj接口自动化框架">pythonj接口自动化框架</a><time datetime="2023-03-07T07:20:54.000Z" title="发表于 2023-03-07 15:20:54">2023-03-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/22/openpyxl%E5%AE%9E%E6%93%8D/" title="openpyxl实操"><img src="/img/python3.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="openpyxl实操"/></a><div class="content"><a class="title" href="/2022/02/22/openpyxl%E5%AE%9E%E6%93%8D/" title="openpyxl实操">openpyxl实操</a><time datetime="2022-02-21T18:40:18.000Z" title="发表于 2022-02-22 02:40:18">2022-02-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/21/%E3%80%90%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80%E3%80%91%E7%9F%A5%E8%AF%86%E7%B2%BE%E8%A6%81/" title="【软件测试基础】知识精要"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【软件测试基础】知识精要"/></a><div class="content"><a class="title" href="/2022/02/21/%E3%80%90%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80%E3%80%91%E7%9F%A5%E8%AF%86%E7%B2%BE%E8%A6%81/" title="【软件测试基础】知识精要">【软件测试基础】知识精要</a><time datetime="2022-02-20T16:15:21.000Z" title="发表于 2022-02-21 00:15:21">2022-02-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/09/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="计算机网络基础知识"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机网络基础知识"/></a><div class="content"><a class="title" href="/2022/01/09/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="计算机网络基础知识">计算机网络基础知识</a><time datetime="2022-01-09T11:41:59.000Z" title="发表于 2022-01-09 19:41:59">2022-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/03/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E5%BF%85%E5%A4%87-linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="软件测试必备:linux常用命令"><img src="/img/linux.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="软件测试必备:linux常用命令"/></a><div class="content"><a class="title" href="/2022/01/03/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E5%BF%85%E5%A4%87-linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="软件测试必备:linux常用命令">软件测试必备:linux常用命令</a><time datetime="2022-01-03T02:21:57.000Z" title="发表于 2022-01-03 10:21:57">2022-01-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 柒仔</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">这只是一个私人笔记blog</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>